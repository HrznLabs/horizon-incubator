<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests; default-src 'self'; script-src 'self' 'sha256-QKBmoVHs2AHhDHQ5OFUIauTLTMoRKR6s6Um5HLBoLLY=' 'sha256-mpLMTyPh3hMJQLiKwz3UCTFgZKT72s5MokrPJqUh8y0=' 'sha256-QqVjgigLlu5hMTLxFd0PKLOUJ0swpICuPAvfcKpSDXk=' https://cdn.jsdelivr.net/npm/mermaid@11.12.3/dist/mermaid.min.js; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self' data:; connect-src 'self'; object-src 'none'; base-uri 'self'; form-action 'none'; frame-src 'none'; worker-src 'none'; manifest-src 'none';">
    <meta name="referrer" content="no-referrer">
    <title>Horizon Rides Vertical â€” Complete Specification</title>
    <!--
        âš¡ Bolt Optimization: Deferred Mermaid.js loading to unblock initial render.
        Moving script to head with 'defer' allows parallel download while HTML parses.
        Initialization is wrapped in DOMContentLoaded to ensure the library is ready.
        âš¡ Bolt Optimization: Consolidated resource hints and added crossorigin attribute for faster connection setup.
        ğŸ›¡ï¸ Sentinel: Added SRI hash to prevent CDN tampering and ensure script integrity.
        ğŸ›¡ï¸ Sentinel: Enforced strict CSP by replacing 'unsafe-inline' with SHA-256 hashes for inline scripts.
        ğŸ›¡ï¸ Sentinel: Updated CSP hash for initialization script and restricted CDN path to specific file.
        ğŸ›¡ï¸ Sentinel: Upgraded Mermaid.js to v11.12.3 to address security vulnerabilities and updated SRI hash.
        ğŸ›¡ï¸ Sentinel: Updated CSP hash for anchor link script after refactoring for performance and security.
        ğŸ›¡ï¸ Sentinel: Restricted 'form-action' to 'none' in CSP to prevent form hijacking.
    -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@11.12.3/dist/mermaid.min.js" integrity="sha384-jFhLSLFn4m565eRAS0CDMWubMqOtfZWWbE8kqgGdU+VHbJ3B2G/4X8u+0BM8MtdU" crossorigin="anonymous" referrerpolicy="no-referrer" defer></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // âš¡ Bolt Optimization: Lazy load Mermaid diagrams to improve initial load performance.
            // Diagrams are rendered only when they approach the viewport using IntersectionObserver.
            mermaid.initialize({
                startOnLoad: false,
                theme: 'dark',
                securityLevel: 'antiscript'
            });

            if ('IntersectionObserver' in window) {
                const observer = new IntersectionObserver((entries, observer) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            mermaid.run({ nodes: [entry.target] });
                            observer.unobserve(entry.target);
                        }
                    });
                }, { rootMargin: '200px 0px' });

                document.querySelectorAll('.mermaid').forEach(el => observer.observe(el));
            } else {
                // Fallback for browsers without IntersectionObserver
                mermaid.run({ nodes: document.querySelectorAll('.mermaid') });
            }
        });
    </script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #eee;
            min-height: 100vh;
            padding: 40px 20px;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 60px; }
        h1 {
            font-size: 3rem;
            background: linear-gradient(90deg, #00d9ff, #00ff88);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        .subtitle { color: #888; font-size: 1.2rem; }
        .section-header {
            font-size: 2rem;
            color: #00d9ff;
            margin: 60px 0 30px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(0,217,255,0.3);
        }
        .diagram-section {
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 40px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .diagram-title {
            font-size: 1.5rem;
            color: #00d9ff;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .diagram-description {
            color: #aaa;
            margin-bottom: 30px;
            line-height: 1.6;
        }
        .mermaid {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 30px;
            overflow-x: auto;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        .toc {
            background: rgba(0,217,255,0.1);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 40px;
        }
        .toc h3 { color: #00d9ff; margin-bottom: 15px; }
        .toc ul { list-style: none; columns: 2; }
        .toc li { margin: 10px 0; }
        .toc a { color: #00ff88; text-decoration: none; }
        .toc a:hover { color: #00d9ff; }
        .badge {
            display: inline-block;
            background: rgba(0,255,136,0.2);
            color: #00ff88;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-left: 10px;
        }
        .badge.critical {
            background: rgba(231,76,60,0.2);
            color: #e74c3c;
        }
        .decisions {
            background: rgba(0,255,136,0.1);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 40px;
        }
        .decisions h3 { color: #00ff88; margin-bottom: 20px; display: flex; align-items: center; }
        .decisions table { width: 100%; border-collapse: collapse; }
        .decisions th, .decisions td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .decisions th { color: #00d9ff; }
        footer {
            text-align: center;
            margin-top: 60px;
            color: #666;
        }

        .back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #00d9ff;
            color: #1a1a2e;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            font-size: 24px;
            cursor: pointer;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 217, 255, 0.3);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .back-to-top.visible {
            opacity: 1;
            visibility: visible;
        }

        .back-to-top:hover,
        .back-to-top:focus-visible {
            transform: translateY(-5px);
            background: #00ff88;
            box-shadow: 0 6px 16px rgba(0, 255, 136, 0.4);
            outline: none;
        }

        .back-to-top:focus-visible {
            outline: 3px solid #00d9ff;
            outline-offset: 2px;
        }

        @media (prefers-reduced-motion: no-preference) {
            html {
                scroll-behavior: smooth;
            }
        }

        .anchor-link {
            opacity: 0;
            margin-left: 0.5em;
            color: #666;
            text-decoration: none;
            border: none;
            background: none;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.8em;
            padding: 4px;
            border-radius: 4px;
        }

        .section-header:hover .anchor-link,
        .diagram-title:hover .anchor-link,
        .decisions h3:hover .anchor-link,
        .anchor-link:focus-visible {
            opacity: 1;
        }

        .anchor-link:hover {
            color: #00d9ff;
            background: rgba(0, 217, 255, 0.1);
            transform: scale(1.1);
        }

        @media print {
            body {
                background: #fff !important;
                color: #000 !important;
                padding: 0 !important;
            }
            .container {
                max-width: 100% !important;
                width: 100% !important;
                margin: 0 !important;
                padding: 20px !important;
            }
            header {
                margin-bottom: 30px;
                text-align: left;
            }
            h1 {
                background: none !important;
                -webkit-text-fill-color: #000 !important;
                color: #000 !important;
                font-size: 2.5rem;
            }
            .subtitle {
                color: #444 !important;
            }
            .section-header {
                color: #000 !important;
                border-bottom: 2px solid #000 !important;
                margin-top: 40px;
            }
            .diagram-section {
                background: none !important;
                border: 1px solid #ccc !important;
                padding: 20px !important;
                page-break-inside: avoid;
            }
            .diagram-title {
                color: #000 !important;
            }
            .diagram-description {
                color: #333 !important;
            }
            .mermaid {
                background: none !important;
                border: none !important;
                padding: 10px 0 !important;
                /* Invert dark-themed diagrams for print readability */
                filter: invert(1) hue-rotate(180deg) !important;
            }
            .decisions {
                background: none !important;
                border: 1px solid #ccc !important;
                color: #000 !important;
            }
            .decisions h3, .decisions th {
                color: #000 !important;
                border-bottom-color: #ccc !important;
            }
            .decisions td {
                border-bottom-color: #eee !important;
            }
            .badge {
                border: 1px solid #000;
                color: #000 !important;
                background: none !important;
            }
            .toc, .back-to-top, .anchor-link {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸš— Horizon Rides Vertical</h1>
            <p class="subtitle">Complete Technical Specification â€” v1.0</p>
        </header>

        <nav class="toc" aria-labelledby="toc-heading">
            <h3 id="toc-heading">ğŸ“‘ Table of Contents</h3>
            <ul>
                <li><a href="#decisions">âœ… Confirmed Decisions</a></li>
                <li><a href="#d30">D30 â€” Standard Ride Flow</a></li>
                <li><a href="#d31">D31 â€” Guild Hierarchy</a></li>
                <li><a href="#d32">D32 â€” Equipment Progression</a></li>
                <li><a href="#d33">D33 â€” Bidirectional Reputation</a></li>
                <li><a href="#d34">D34 â€” Real-Time Tracking</a></li>
                <li><a href="#d35">D35 â€” Hybrid Pricing</a></li>
                <li><a href="#d36">D36 â€” Cancellation Logic</a></li>
                <li><a href="#d37">D37 â€” Matching Engine Architecture</a></li>
                <li><a href="#d38">D38 â€” Match Score Formula</a></li>
                <li><a href="#d39">D39 â€” Shared Ride Matching</a></li>
                <li><a href="#d40">D40 â€” Driver State Machine</a></li>
                <li><a href="#d41">D41 â€” Offer Lifecycle</a></li>
                <li><a href="#d42">D42 â€” Surge Pricing Flow</a></li>
            </ul>
        </nav>

        <section id="decisions" class="decisions">
            <h3>âœ… Confirmed Design Decisions</h3>
            <table>
                <tr><th>Area</th><th>Decision</th></tr>
                <tr><td>Mission Pattern</td><td>Both Rider-as-Poster (primary) AND Driver-as-Poster (occasional rides)</td></tr>
                <tr><td>Surge Pricing</td><td>Guild-controlled + Market algorithm</td></tr>
                <tr><td>XP System</td><td>Hybrid (Global XP + Rides-specific XP)</td></tr>
                <tr><td>Fee Reduction</td><td>Streak-based temporary discounts (up to -10% at 60+ days)</td></tr>
                <tr><td>Guild Curation</td><td>Bidirectional (drivers AND riders curated)</td></tr>
                <tr><td>Geographic Guilds</td><td>Drivers can be in multiple; activity requirements per guild</td></tr>
                <tr><td>Real-time Tracking</td><td>Opt-in but RECOMMENDED; rider always sees driver</td></tr>
                <tr><td>Route Recording</td><td>Full route, shareable for safety</td></tr>
                <tr><td>Equipment Funding</td><td>All 5 paths: self-purchase, guild, brand, auto-save, onboarding</td></tr>
                <tr><td>Compliance Tier 0</td><td>Exists for P2P/friends/family rides</td></tr>
                <tr><td>Multi-Rider Pricing</td><td>Hybrid: Distance (60%) + Time (40%)</td></tr>
                <tr><td>Platform Liability</td><td>Infrastructure only â€” guilds handle compliance</td></tr>
            </table>
        </section>

        <h2 class="section-header">ğŸš• Core Ride Flows</h2>

        <section id="d30" class="diagram-section">
            <h2 class="diagram-title">ğŸ“ D30 â€” Standard Ride Mission Flow <span class="badge">Core</span></h2>
            <p class="diagram-description">Complete lifecycle from request to settlement.</p>
            <div class="mermaid">
sequenceDiagram
    participant R as Rider
    participant ME as Matching Engine
    participant D as Driver
    participant BC as Blockchain

    rect rgba(0, 217, 255, 0.1)
        Note over R,BC: REQUEST & MATCH
        R->>ME: Request ride
        ME->>ME: Filter candidates
        ME->>ME: Score & select
        ME->>D: Offer (15s timeout)
        D->>ME: Accept
        ME->>BC: Create mission (escrow)
        ME->>R: Driver matched!
    end

    rect rgba(255, 136, 0, 0.1)
        Note over R,BC: RIDE
        D->>R: En route (live tracking)
        D->>R: Arrived at pickup
        R->>ME: Confirm pickup
        D->>R: Ride in progress
        D->>ME: Arrive at dropoff
    end

    rect rgba(0, 255, 136, 0.1)
        Note over R,BC: SETTLEMENT
        ME->>BC: Complete mission
        BC->>D: USDC transferred
        BC->>R: DDR refunded
        R->>ME: Rate driver â­
        D->>ME: Rate rider â­
    end
            </div>
        </section>

        <h2 class="section-header">ğŸ›ï¸ Guild & Reputation</h2>

        <section id="d31" class="diagram-section">
            <h2 class="diagram-title">ğŸ›ï¸ D31 â€” Rides Guild Hierarchy</h2>
            <p class="diagram-description">MetaGuild umbrella with geographic, specialty, and quality tier sub-guilds.</p>
            <div class="mermaid">
flowchart TB
    META["ğŸš— RidesMetaGuild"]
    
    subgraph Geo["Geographic"]
        G1["ğŸ‡µğŸ‡¹ Lisbon"]
        G2["ğŸ‡µğŸ‡¹ Porto"]
        G3["ğŸ‡¬ğŸ‡§ London"]
    end
    
    subgraph Spec["Specialty"]
        S1["ğŸŒ± EcoRides"]
        S2["â™¿ Access"]
        S3["ğŸŒ™ NightOwl"]
    end
    
    subgraph Qual["Quality"]
        Q1["â­ Premium"]
        Q2["ğŸ‘‘ Luxury"]
        Q3["ğŸ’° Budget"]
    end
    
    META --> Geo
    META --> Spec
    META --> Qual
            </div>
        </section>

        <section id="d33" class="diagram-section">
            <h2 class="diagram-title">â­ D33 â€” Bidirectional Reputation Flow</h2>
            <p class="diagram-description">Both drivers AND riders are rated and can be curated by guilds.</p>
            <div class="mermaid">
flowchart LR
    RIDE["âœ… Ride<br/>Complete"] --> DR["Driver rates<br/>Rider â­"]
    RIDE --> RR["Rider rates<br/>Driver â­"]
    
    DR --> RP["Rider Profile<br/>â”â”â”â”â”â”â”â”â”â”<br/>Rating given: 4.2<br/>Cancel rate: 3%"]
    RR --> DP["Driver Profile<br/>â”â”â”â”â”â”â”â”â”â”<br/>Rating: 4.87<br/>Rides: 847"]
    
    RP --> GCR["Guild can<br/>curate RIDERS"]
    DP --> GCD["Guild can<br/>curate DRIVERS"]
            </div>
        </section>

        <h2 class="section-header">ğŸ¯ Matching Engine <span class="badge critical">CRITICAL</span></h2>

        <section id="d37" class="diagram-section">
            <h2 class="diagram-title">ğŸ¯ D37 â€” Matching Engine Architecture</h2>
            <p class="diagram-description">Real-time matching with 4-phase pipeline: Filter â†’ Score â†’ Select â†’ Offer.</p>
            <div class="mermaid">
flowchart TB
    REQ["ğŸš• Ride Request"] --> F["FILTER<br/>â”â”â”â”â”â”â”â”<br/>Distance<br/>Status<br/>Capacity<br/>Eligibility"]
    
    F --> S["SCORE<br/>â”â”â”â”â”â”â”â”<br/>ETA 30%<br/>Rating 25%<br/>Fairness 15%<br/>Guild 10%<br/>Other 20%"]
    
    S --> SEL["SELECT<br/>â”â”â”â”â”â”â”â”<br/>Best match<br/>or weighted<br/>random"]
    
    SEL --> OFF["OFFER<br/>â”â”â”â”â”â”â”â”<br/>15s timeout"]
    
    OFF -->|"Accept"| MATCH["ğŸ‰ MATCHED"]
    OFF -->|"Decline/Timeout"| RETRY["ğŸ”„ RETRY"]
    RETRY -->|"< 5"| SEL
    RETRY -->|">= 5"| FAIL["âŒ NO MATCH"]
            </div>
        </section>

        <section id="d38" class="diagram-section">
            <h2 class="diagram-title">ğŸ“Š D38 â€” Match Score Formula</h2>
            <p class="diagram-description">Weighted scoring across 8 factors including bidirectional ratings.</p>
            <div class="mermaid">
flowchart LR
    subgraph Factors["Scoring Factors (Total: 100%)"]
        E["ğŸ“ ETA<br/>30%"]
        D["â­ Driver<br/>15%"]
        R["ğŸ‘¤ Rider<br/>10%"]
        F["âš–ï¸ Fair<br/>15%"]
        G["ğŸ›ï¸ Guild<br/>10%"]
        P["ğŸ’° Price<br/>10%"]
        PR["ğŸ¯ Pref<br/>5%"]
        ST["ğŸ”¥ Streak<br/>5%"]
    end
    
    Factors --> CALC["Calculate<br/>Weighted Sum"]
    CALC --> RANK["Rank<br/>Candidates"]
            </div>
        </section>

        <section id="d39" class="diagram-section">
            <h2 class="diagram-title">ğŸ‘¥ D39 â€” Shared Ride Matching</h2>
            <p class="diagram-description">Adding riders to active routes with detour checking and fair price splitting.</p>
            <div class="mermaid">
flowchart TB
    R1["Rider 1<br/>On ride Aâ†’B"] --> CHECK["Check New<br/>Request Câ†’D"]
    
    CHECK --> COMPAT{"Route<br/>Compatible?<br/>Detour<30%?"}
    
    COMPAT -->|"Yes"| ADD["Add to Ride"]
    COMPAT -->|"No"| NEW["New Driver"]
    
    ADD --> PRICE["Hybrid Pricing<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Distance: 60%<br/>Time: 40%"]
    
    PRICE --> R1D["Rider 1: -25%"]
    PRICE --> R2D["Rider 2: $12"]
            </div>
        </section>

        <section id="d40" class="diagram-section">
            <h2 class="diagram-title">ğŸ”„ D40 â€” Driver State Machine</h2>
            <p class="diagram-description">Driver availability states and transitions.</p>
            <div class="mermaid">
stateDiagram-v2
    [*] --> OFFLINE
    OFFLINE --> ONLINE: Go Online
    ONLINE --> EN_ROUTE: Accept Ride
    ONLINE --> OFFLINE: Go Offline
    EN_ROUTE --> WAITING: Arrive
    WAITING --> ON_RIDE: Pickup
    ON_RIDE --> COMPLETING: Dropoff
    ON_RIDE --> ON_RIDE: Add Shared Rider
    COMPLETING --> ONLINE: Rate & Continue
    COMPLETING --> OFFLINE: Rate & Stop
            </div>
        </section>

        <section id="d41" class="diagram-section">
            <h2 class="diagram-title">ğŸ“¨ D41 â€” Offer Lifecycle</h2>
            <p class="diagram-description">15-second offer window with retry logic.</p>
            <div class="mermaid">
flowchart LR
    SEL["Select<br/>Driver"] --> OFF["Send<br/>Offer"]
    OFF --> WAIT["15s<br/>Timer"]
    
    WAIT --> ACC["âœ… Accept"] --> MATCH["ğŸ‰ Match!"]
    WAIT --> DEC["âŒ Decline"] --> NEXT
    WAIT --> TO["â° Timeout"] --> NEXT
    
    NEXT["Next<br/>Driver"] -->|"<5"| SEL
    NEXT -->|">=5"| FAIL["âŒ Fail"]
            </div>
        </section>

        <h2 class="section-header">ğŸ’° Pricing & Economics</h2>

        <section id="d35" class="diagram-section">
            <h2 class="diagram-title">ğŸ’° D35 â€” Hybrid Pricing Model</h2>
            <p class="diagram-description">5-layer pricing: Distance â†’ Guild â†’ Surge â†’ Rider Choice â†’ Driver Accept.</p>
            <div class="mermaid">
flowchart LR
    L1["Distance<br/>$19.50"] --> L2["Guild Min<br/>$22"]
    L2 --> L3["Surge 1.3x<br/>$28.60"]
    L3 --> L4["Rider<br/>Accepts"]
    L4 --> L5["Driver<br/>Accepts"]
    L5 --> FINAL["âœ… $28.60"]
            </div>
        </section>

        <section id="d42" class="diagram-section">
            <h2 class="diagram-title">ğŸ“ˆ D42 â€” Surge Pricing Flow</h2>
            <p class="diagram-description">Demand-based multipliers with guild-configured limits.</p>
            <div class="mermaid">
flowchart TB
    DEM["Demand: 12 requests"] --> RATIO
    SUP["Supply: 3 drivers"] --> RATIO
    RATIO["Ratio: 0.25"] --> MULT["Surge: 2.2x"]
    GMAX["Guild Max: 2.5x"] --> MULT
    
    MULT --> PRICE["$20 â†’ $44"]
    PRICE --> SPLIT["Driver: +$19<br/>Guild: +$5"]
            </div>
        </section>

        <h2 class="section-header">ğŸ“¦ Progression & Equipment</h2>

        <section id="d32" class="diagram-section">
            <h2 class="diagram-title">ğŸ“¦ D32 â€” Equipment Progression</h2>
            <p class="diagram-description">6 tiers with 5 funding paths available.</p>
            <div class="mermaid">
flowchart LR
    R25["25 rides"] --> E1["ğŸ“± Starter<br/>$25-40"]
    R100["100 rides"] --> E2["ğŸ’¡ Bronze<br/>$15-30"]
    R300["300 rides"] --> E3["ğŸ“¹ Silver<br/>$150-250"]
    R750["750 rides"] --> E4["ğŸ Gold<br/>$100-150"]
    R1500["1500 rides"] --> E5["ğŸ“· Platinum<br/>$300-400"]
    R3000["3000 rides"] --> E6["ğŸ’ Diamond<br/>+ NFT"]
    
    subgraph Funding["5 Funding Paths"]
        F1["ğŸ’³ Self"]
        F2["ğŸ›ï¸ Guild"]
        F3["ğŸ¢ Brand"]
        F4["ğŸ’° Auto-save"]
        F5["ğŸ¯ Onboarding"]
    end
            </div>
        </section>

        <h2 class="section-header">ğŸ›¡ï¸ Safety & Compliance</h2>

        <section id="d34" class="diagram-section">
            <h2 class="diagram-title">ğŸ“¡ D34 â€” Real-Time Tracking</h2>
            <p class="diagram-description">WebSocket-based tracking with privacy controls.</p>
            <div class="mermaid">
flowchart TB
    D["Driver App"] -->|"location"| WS["WebSocket"]
    WS --> REDIS["Redis Pub/Sub"]
    REDIS --> R["Rider App"]
    REDIS --> S["Shared Link<br/>(Friends)"]
    
    subgraph Privacy["Privacy Controls"]
        P1["~1km before accept"]
        P2["Exact after accept"]
        P3["30-day retention"]
        P4["Opt-in tracking"]
    end
            </div>
        </section>

        <section id="d36" class="diagram-section">
            <h2 class="diagram-title">ğŸš« D36 â€” Cancellation Logic</h2>
            <p class="diagram-description">Fair policies for both riders and drivers.</p>
            <div class="mermaid">
flowchart TB
    subgraph Rider["Rider Cancels"]
        RC1["Before match: $0"]
        RC2["After accept: $1-2"]
        RC3["En route: $3-5"]
        RC4["Arrived: $5-8"]
    end
    
    subgraph Driver["Driver Cancels"]
        DC1["Before pickup: -3 rep"]
        DC2["After accept: -5 rep"]
        DC3["No-show: DDR penalty"]
    end
    
    subgraph Wait["Wait Time"]
        W1["Driver waits: $0.25/min"]
        W2["Rider waits: $0.15/min"]
    end
            </div>
        </section>

        <footer>
            <p>Horizon Protocol â€” Rides Vertical Specification v1.0</p>
            <p>Created December 2025 â€¢ 13 Diagrams â€¢ Ready for Implementation</p>
        </footer>
    </div>

    <button id="back-to-top" class="back-to-top" aria-label="Back to top" title="Back to top">â†‘</button>

    <script>
        const backToTopButton = document.getElementById('back-to-top');
        let ticking = false;

        window.addEventListener('scroll', () => {
            if (!ticking) {
                window.requestAnimationFrame(() => {
                    if (window.scrollY > 300) {
                        backToTopButton.classList.add('visible');
                    } else {
                        backToTopButton.classList.remove('visible');
                    }
                    ticking = false;
                });
                ticking = true;
            }
        }, { passive: true });

        backToTopButton.addEventListener('click', () => {
            const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
            window.scrollTo({
                top: 0,
                behavior: prefersReducedMotion ? 'auto' : 'smooth'
            });
        });
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const addAnchors = () => {
                const sections = document.querySelectorAll('section[id]');
                sections.forEach(section => {
                    const heading = section.querySelector('h1, h2, h3');
                    if (!heading || heading.querySelector('.anchor-link')) return;

                    const btn = document.createElement('button');
                    btn.className = 'anchor-link';
                    btn.textContent = 'ğŸ”—';
                    btn.setAttribute('aria-label', 'Copy link to section');
                    btn.title = 'Copy link to section';

                    heading.appendChild(btn);
                });
            };

            if ('requestIdleCallback' in window) {
                requestIdleCallback(addAnchors);
            } else {
                setTimeout(addAnchors, 200);
            }

            document.body.addEventListener('click', async (e) => {
                const btn = e.target.closest('.anchor-link');
                if (!btn) return;

                const section = btn.closest('section');
                if (!section || !section.id) return;

                try {
                    // ğŸ›¡ï¸ Sentinel: URL encode the section ID to prevent fragment injection attacks.
                    const url = window.location.origin + window.location.pathname + '#' + encodeURIComponent(section.id);
                    await navigator.clipboard.writeText(url);

                    const originalText = btn.textContent;
                    btn.textContent = 'âœ…';
                    setTimeout(() => btn.textContent = originalText, 2000);
                } catch (err) {
                    // ğŸ›¡ï¸ Sentinel: Suppressed raw error object in console.error to prevent information leakage.
                    console.error('Failed to copy link to clipboard');
                }
            });
        });
    </script>
</body>
</html>
